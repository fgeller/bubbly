
table "repo" {
    field "name" {
        type = string
        unique = true
    }

    table "repo_version" {
        field "commit" {
            type = string
            unique = true
        }
        field "tag" {
            type = string
        }
        field "branch" {
            type = string
        }
    }
}

table "code_issue" {
    join "repo_version" { }
    field "name" {
        type = string
    }
    field "severity" {
        type = string
    }
    field "type" {
        type = string
    }
}

table "test_run" {
    field "repo_version_id" {
        type = number
    }

    field "name" {
        type = string
        unique = true
    }
    field "description" {
        type = string
    }

    field "elapsed" {
        type = number
    }

    table "test_set" {
        field "name" {
            type = string
        }
        field "description" {
            type = string
        }

        table "test_case" {

            field "name" {
                type = string
            }
            field "status" {
                type = string
            }

            table "step" {
                field "name" {
                    type = string
                }
                join "step" {}
            }
            table "failure" {
                field "type" {
                    type = string
                }
                field "message" {
                    type = string
                }
            }
        }
    }
}

table "spdx_license" {
    field "id" {
        type = string
        unique = true
    }
    field "name" {
        type = string
    }
    field "crossref_count" {
        type = number
    }
}

# GitHub GraphQL API
table "bubbly_repo" {

    field "owner" {
        type = string
    }
    field "name" {
        type = string
    }
    # TODO: would be useful if could say that (owner, name) tuple is unique

    field "fork_count" {
        type = number
    }
    field "stargazer_count" {
        type = number
    }
    field "watcher_count" {
        type = number
    }
    field "open_issues_count" {
        type = number
    }
    field "closed_issues_count" {
        type = number
    }
    field "releases_count" {
        type = number
    }
    field "download_count" {
        type = number
    }

    table "issues" {
        field "title" {
            type = string
        }
        field "url" {
            type   = string
            unique = true
        }
        field "state" {
            type = string
        }
    }
}
